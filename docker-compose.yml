# igual que el dockerfile, basado en lo que tiene mi grupo del proyecto para
#   manejar la bdd mysql, con un poco a√±adido para intentar solucionar problemas
version: '3.8'
services:
  bddmysql:
    image: mysql:8.0
    container_name: muebleria_mysql_docker
    environment:
      MYSQL_ROOT_PASSWORD: 11
      MYSQL_DATABASE: bdd_muebleria_ingsoft
    ports:
      - "3307:3306"
    volumes:
      - db_data:/var/lib/mysql
      - ./bdd:/docker-entrypoint-initdb.d
    restart: always
    networks:
      - spring-cloud-network

  muebleria:
    build:
      context: .
    container_name: muebleria_backend
    ports:
      - "1984:1984"
    depends_on:
      - bddmysql
    environment:
      SPRING_APPLICATION_JSON: '{
        "spring.datasource.url"  : "jdbc:mysql://bddmysql:3036/bdd_muebleria_ingsoft?useSSL=false",
        "spring.datasource.username" : "root",
        "spring.datasource.password" : "11",
        "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQLDialect",
        "spring.jpa.hibernate.ddl-auto" : "update"
      }'
      #SPRING_DATASOURCE_URL: jdbc:mysql://bddmysql:3306/bdd_muebleria_ingsoft?useSSL=false
      #SPRING_DATASOURCE_USERNAME: root
      #SPRING_DATASOURCE_PASSWORD: root
      #SPRING_HIBERNATE_DIALECT: org.hibernate.dialect.MySQLDialect
      #SPRING_HIBERNATE_DLL_AUTO: update
    restart: always
    networks:
      - spring-cloud-network

  phpmyadminB:
    image: phpmyadmin/phpmyadmin
    container_name: muebleria_phpmyadmin
    environment:
      PMA_HOST: bddmysql
      PMA_PORT: 3306
      MYSQL_ROOT_PASSWORD: 11
    ports:
      - "8081:80"
    depends_on:
      - bddmysql
    restart: always
    networks:
      - spring-cloud-network

networks:
  spring-cloud-network:
    driver: bridge

volumes:
  db_data: